{% extends "base.html" %} {% block content %} <div class="row g-4"> <div class="col-lg-8"> <div class="card h-100"> <div class="card-header"> <i class="fa-solid fa-sliders"></i> Heat Parameters </div> <div class="card-body p-4"> <form id="calcForm" method="POST" action="{{ url_for('confirm_injection') }}"> <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">Identification</h6> <div class="row g-3 mb-4"> <div class="col-md-6"> <label class="form-label">Heat ID</label> <input type="text" class="form-control fw-bold" name="heat_id" required> </div> <div class="col-md-6"> <label class="form-label">LF Number</label> <input type="text" class="form-control" name="lf_number" required> </div> </div> <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">Conditions</h6> <div class="row g-3 mb-4"> <div class="col-md-4"> <label class="form-label">Tonnage</label> <input type="number" step="0.1" class="form-control" id="tonnage" name="tonnage" value="150" required> </div> <div class="col-md-4"> <label class="form-label">Freeboard</label> <input type="number" class="form-control" id="freeboard" name="freeboard" value="400"> </div> <div class="col-md-4"> <label class="form-label">Temp</label> <input type="number" class="form-control" id="temp" name="temp" value="1580" required> </div> </div> <h6 class="text-primary fw-bold mb-3 border-bottom pb-2">Chemistry</h6> <div class="row g-3 mb-4"> <div class="col-md-4"> <label class="form-label">Al%</label> <input type="number" step="0.001" class="form-control" id="al" name="al" value="0.040"> </div> <div class="col-md-4"> <label class="form-label">S%</label> <input type="number" step="0.001" class="form-control" id="s" name="s" value="0.005"> </div> <div class="col-md-4"> <label class="form-label">Si%</label> <input type="number" step="0.001" class="form-control" id="si" name="si_pct" value="0.200"> </div> <div class="col-md-6"> <label class="form-label">Initial P%</label> <input type="number" step="0.001" class="form-control" id="p_initial" name="p_initial" value="0.012"> </div> <div class="col-md-6"> <label class="form-label">Before Inj P%</label> <input type="number" step="0.001" class="form-control" id="p_before" name="p_before" value="0.015"> </div> </div> <div class="row g-3"> <div class="col-md-12"> <label class="form-label">Speed (m/min)</label> <input type="number" class="form-control" id="speed" value="120"> </div> </div> <input type="hidden" id="calculated_length_hidden" name="calculated_length_hidden" value="0"> </form> </div> </div> </div> <div class="col-lg-4"> <div class="card h-100 border-0 bg-dark text-white" style="background: var(--primary-grad);"> <div class="card-body d-flex flex-column justify-content-between p-4"> <div> <h5 class="fw-bold mb-4">Intelligent Prediction</h5> <div class="p-3 rounded-3 mb-4" style="background: rgba(255,255,255,0.1);"> <div class="d-flex justify-content-between mb-2"> <span class="small text-white-50">Active Coil</span> <span class="fw-bold text-white">{{ coil.coil_number }}</span> </div> </div> <button type="button" class="btn btn-light w-100 py-3 fw-bold shadow-lg mb-4" onclick="predictLength()"> CALCULATE </button> </div> <div class="text-center py-4 rounded-4 mb-4" style="background: rgba(0,0,0,0.2);"> <h6 class="text-info text-uppercase">Required Wire</h6> <h1 class="display-3 fw-bolder my-1 text-white"><span id="resultDisplay">0.00</span><span class="fs-4">m</span></h1> <div class="badge bg-secondary mt-2 px-3 py-2" id="timeDisplay">0.00 min</div> </div> <button type="submit" form="calcForm" class="btn btn-accent w-100 py-3 fs-5 rounded-pill" id="injectBtn" disabled> CONFIRM & INJECT </button> </div> </div> </div> </div> {% endblock %} {% block scripts %} <script> function predictLength() { const btn = document.querySelector('button[onclick="predictLength()"]'); const originalText = btn.innerHTML; btn.innerHTML = 'Processing...'; const data = { tonnage: document.getElementById('tonnage').value, freeboard: document.getElementById('freeboard').value, speed: document.getElementById('speed').value, temp: document.getElementById('temp').value, al: document.getElementById('al').value, s: document.getElementById('s').value, si: document.getElementById('si').value, p_initial: document.getElementById('p_initial').value, p_before: document.getElementById('p_before').value }; fetch('/calculate_api', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) }).then(response => response.json()).then(data => { btn.innerHTML = originalText; if(data.success) { document.getElementById('resultDisplay').innerText = data.length_m; document.getElementById('timeDisplay').innerText = data.time_min + " min"; document.getElementById('calculated_length_hidden').value = data.length_m; document.getElementById('injectBtn').disabled = false; } else { alert("Error: " + data.error); if (data.redirect) window.location.href = data.redirect; } }).catch(err => { btn.innerHTML = originalText; console.error(err); }); } </script> {% endblock %}